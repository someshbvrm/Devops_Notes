
---

# üê≥ **Dockerfile Hands-On: Build Jenkins Image with Tomcat**

---

## **1Ô∏è‚É£ Install Docker on Ubuntu**

```bash
sudo apt update
sudo apt install docker.io -y
sudo service docker start
sudo systemctl enable docker
sudo usermod -aG docker ubuntu   # Allow docker commands without sudo

# Restart your session for group changes to take effect
```

### Verify Docker

```bash
docker info   # Ensure Docker is running
```

---

## **2Ô∏è‚É£ Create Project Directory for Dockerfile**

```bash
mkdir tomcat
cd tomcat
vi Dockerfile
```

---

## **3Ô∏è‚É£ Sample Dockerfile for Tomcat + Jenkins**

```dockerfile
# Use official Tomcat image
FROM tomcat:latest
LABEL maintainer="info@cloudsoftsol.com"

# Copy Jenkins WAR file into Tomcat webapps
COPY jenkins.war /usr/local/tomcat/webapps/

# Expose Tomcat HTTP port
EXPOSE 8080

# Start Tomcat
CMD ["catalina.sh", "run"]
```

---

## **4Ô∏è‚É£ Download Jenkins WAR**

```bash
wget https://updates.jenkins.io/download/war/2.523/jenkins.war
```

> Ensure `jenkins.war` is in the `/tomcat` directory before building the image.

---

## **5Ô∏è‚É£ Build Docker Image**

```bash
docker build -t mytomcat:1 .   # Builds image using current directory (.)
```

> ‚ö° Docker first downloads `tomcat:latest` image, then adds your layers on top.

### Verify Images

```bash
docker images
# Example output:
# tomcat              latest
# mytomcat            1
```

> To create a new version:

```bash
docker build -t mytomcat:2 .
docker images
```

---

## **6Ô∏è‚É£ Create Volume for Persistence**

```bash
docker volume create myvol
```

### Run Container with Volume Mapping

```bash
docker run --name mytomcat \
  -p 8081:8080 \
  -v myvol:/usr/local/tomcat/webapps \
  -d mytomcat:2
```

> Volume path on host: `/var/lib/docker/volumes/myvol/_data/`
> WAR files copied to container also appear here.

---

## **7Ô∏è‚É£ Build Custom WAR File (Example with SparkJava)**

```bash
cd ~
git clone https://github.com/kliakos/sparkjava-war-example.git
cd sparkjava-war-example/
sudo apt install maven -y

# Build WAR file
mvn clean test package
```

### Copy WAR to Docker Volume

```bash
cp target/sparkjava-hello-world-1.0.war /var/lib/docker/volumes/myvol/_data/
```

### Verify inside Container

```bash
docker exec -it mytomcat /bin/bash
cd /usr/local/tomcat/webapps/
ls  # Check for sparkjava-hello-world-1.0.war
exit
```

> You can also run commands directly from host:

```bash
docker exec -it mytomcat ls /usr/local/tomcat/webapps/
```

---

## **8Ô∏è‚É£ Docker Networking**

### Create Custom Network

```bash
docker network create mynetwork
docker network ls
```

### Attach Container to Network

```bash
docker network connect mynetwork mytomcat
docker inspect mytomcat   # Check network info
```

### Detach Container from Network

```bash
docker network disconnect mynetwork mytomcat
# Container reverts to default bridge network
```

---

## ‚úÖ **Key Notes**

* **Volumes** keep data persistent even if the container is deleted.
* **WAR deployment**: Copy to volume ‚Üí automatically reflects inside container.
* **Port Mapping**: `-p host_port:container_port` (host ports must be unique).
* **Network**: Containers on same network can communicate; otherwise isolated.
* **Multiple Versions**: Use tags (`mytomcat:1`, `mytomcat:2`) for versioning images.

---
