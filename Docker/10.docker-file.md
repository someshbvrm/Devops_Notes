
---

# 🐳 **Dockerfiles – Hands-On Guide**

Dockerfiles are **text documents containing instructions** to create custom Docker images. Each instruction forms a **layer** in the image.

---

## 🏗 **Dockerfile Structure**

A Dockerfile typically includes:

1. **Base OS or Base Image**

   * OS images: `alpine`, `ubuntu`, `centos`
   * Base images: `nginx`, `mysql`, `openjdk`, `tomcat`

2. **Application / Build Code**

   * WAR, JAR, Python, Node.js files

3. **Settings / Environment Variables**

4. **Certificates / Secrets** (avoid sensitive info in image)

5. **Exposed Ports**

> ⚠️ If you have **12 microservices**, create **12 Dockerfiles**, each in its own directory.

---

## ⚡ **Build and Run Images**

```bash
# Build an image from current directory Dockerfile
docker build -t myimage:1.1 .

# Build image from a specific path
docker build -t mynewimage:1.1 microservice1/

# Default tag is latest if not specified
docker build -t mynewimage microservice1/

# Run container from image
docker run --name mytomcat -p 8084:8080 -d mynewimage:1.1
```

---

## 📄 **Dockerfile Instructions**

| Instruction  | Purpose                                                     |
| ------------ | ----------------------------------------------------------- |
| `FROM`       | Base OS or base image                                       |
| `MAINTAINER` | Deprecated; use `LABEL maintainer="email"`                  |
| `RUN`        | Executes commands during image build; creates layers        |
| `WORKDIR`    | Sets working directory for subsequent instructions          |
| `COPY`       | Copy files from host to container (preferred)               |
| `ADD`        | Copy files/URL and auto-extract archives (use with caution) |
| `EXPOSE`     | Expose container port (internal port)                       |
| `CMD`        | Default command executed at container runtime               |
| `ENTRYPOINT` | Default executable for container (PID 1)                    |
| `ENV`        | Set environment variables                                   |
| `ARG`        | Build-time variables                                        |

---

## 📝 **Example 1 – CentOS + Tomcat + WAR**

```dockerfile
FROM centos
LABEL maintainer="email@example.com"

# Install dependencies
RUN mkdir /opt/tomcat/
WORKDIR /opt/tomcat
RUN curl -O https://www-eu.apache.org/dist/tomcat/tomcat-8/v8.5.40/bin/apache-tomcat-8.5.40.tar.gz
RUN tar xvfz apache*.tar.gz
RUN mv apache-tomcat-8.5.40/* /opt/tomcat/.
RUN yum -y install java-1.8.0-openjdk
RUN java -version

# Deploy sample app
WORKDIR /opt/tomcat/webapps
RUN curl -O -L https://github.com/AKSarav/SampleWebApp/raw/master/dist/SampleWebApp.war

# Expose port and start Tomcat
EXPOSE 8080
CMD ["/opt/tomcat/bin/catalina.sh", "run"]
```

**Explanation:**

* Base image: `centos`
* Install dependencies, create `/opt/tomcat`
* Download and extract Tomcat
* Deploy sample WAR
* Expose 8080 and start Tomcat

**Run Image:**

```bash
docker build -t my-tomcat-image .
docker run -d -p 8081:8080 my-tomcat-container
```

---

## 📝 **Example 2 – Using Tomcat Base Image (Recommended)**

```dockerfile
FROM tomcat:9
LABEL maintainer="your-email@example.com"
COPY ./target/*.war /usr/local/tomcat/webapps/
EXPOSE 8080
CMD ["catalina.sh", "run"]
```

> ✅ Using **base images** reduces image size and avoids installing OS dependencies manually.

---

## 🐍 **Python Dockerfile Example**

```dockerfile
FROM python:3
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1
WORKDIR /code
COPY requirements.txt /code/
RUN pip install -r requirements.txt
COPY ./code/ /code/
EXPOSE 8080
CMD ["python", "server.py"]
```

---

## 🟢 **Node.js Dockerfile Example**

```dockerfile
FROM node:12.18.1
ENV NODE_ENV=production
WORKDIR /app
COPY ["package.json", "package-lock.json*", "./"]
RUN npm install --production
COPY . .
EXPOSE 8080
CMD ["node", "server.js"]
```

---

## ☕ **Spring Boot Dockerfile Example**

```dockerfile
FROM openjdk:8-jdk-alpine
LABEL maintainer="your-email@example.com"
ARG JAR_FILE=target/*.jar
COPY ${JAR_FILE} app.jar
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

---

## ⚡ **.NET Dockerfile Example**

```dockerfile
FROM mcr.microsoft.com/dotnet/sdk:6.0

RUN useradd -m appuser
WORKDIR /app
COPY *.csproj ./
RUN dotnet restore
COPY . ./
RUN dotnet build -c Release
RUN chmod +x ./entrypoint.sh

EXPOSE 80
USER appuser
CMD ["./entrypoint.sh"]
```

---

## 🆚 **RUN vs ENTRYPOINT**

| Command      | When it runs                | Purpose                                                                                |
| ------------ | --------------------------- | -------------------------------------------------------------------------------------- |
| `RUN`        | Build time (`docker build`) | Install dependencies, compile code, create layers                                      |
| `ENTRYPOINT` | Runtime (`docker run`)      | Container's main process (PID 1)                                                       |
| `CMD`        | Runtime default args        | Provides default arguments to ENTRYPOINT or acts as main command if ENTRYPOINT omitted |

> ✅ **Best Practice:**
>
> * `RUN` for setup
> * `ENTRYPOINT` for main container process
> * `CMD` for default arguments

---
