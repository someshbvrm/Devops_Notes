
---

# ğŸ³ Docker Swarm vs â˜¸ï¸ Kubernetes

---

## ğŸ”¹ **Docker Swarm**

**Definition**: A lightweight container orchestration tool built into Docker.
**Best Use**: Suitable for **small to medium** microservices deployments.

### âŒ Limitations of Docker Swarm

* ğŸš« **No Auto Scaling** â†’ Cannot automatically add/remove containers based on demand.
* ğŸš« **No Self-Healing** â†’ If a container fails, it wonâ€™t restart automatically.
* ğŸš« **Not for Enterprise** â†’ Limited for large-scale deployments.

---

## ğŸ”¹ **Kubernetes (K8s)**

**Definition**: A powerful, open-source container orchestration platform (think of it as the **pilot of containers**).
**Best Use**: Designed for **large-scale, production-grade** deployments.

### âœ… Key Functions

* âš¡ **Automatic Provisioning** â€“ Creates and manages containers automatically.
* ğŸ“ˆ **Scaling (Up/Down)** â€“ Adjusts the number of containers based on workload.
* âš–ï¸ **Load Balancing** â€“ Distributes traffic across containers efficiently.
* ğŸ”„ **Self-Healing** â€“ Restarts failed containers automatically.
* ğŸ—‘ï¸ **Destroy** â€“ Removes unnecessary or failed containers.
* â®ï¸ **Update & Rollback** â€“ Deploy updates and roll back if issues occur.

---

# â˜¸ï¸ Kubernetes Architecture

Kubernetes consists of **two main parts**:

### ğŸ§  Control Plane (Master) â€“ The Brains

* ğŸ“¡ **API Server** â†’ Entry point; receives commands (`kubectl`)
* ğŸ¯ **Scheduler** â†’ Decides which node runs a new pod
* ğŸ› ï¸ **Controller Manager** â†’ Ensures desired cluster state
* ğŸ—„ï¸ **etcd** â†’ Distributed key-value store for cluster data

### âš™ï¸ Nodes (Workers)

* ğŸ‘· **Kubelet** â†’ Ensures pods are running on nodes
* ğŸ”€ **Kube-Proxy** â†’ Handles networking & load balancing
* ğŸ³ **Container Runtime** â†’ Runs containers (Docker, containerd, CRI-O)
* ğŸ“¦ **Pods** â†’ Smallest deployable unit (1 or more containers)

---

# ğŸ–¥ï¸ Kubernetes Command-Line Tools

* ğŸ”§ **kubectl** â†’ Main CLI for cluster interaction

  ```bash
  kubectl get pods
  kubectl apply -f deployment.yaml
  ```

* â˜ï¸ **eksctl** â†’ AWS-specific Kubernetes management tool

* ğŸš€ **kubeadm** â†’ Bootstrap/init Kubernetes cluster

  ```bash
  kubeadm init
  kubeadm join
  ```

* ğŸ–¼ï¸ **Kubernetes Dashboard** â†’ Web GUI

* ğŸŒ **kube-dns** â†’ DNS inside cluster

* ğŸ—‚ï¸ **Namespaces** â†’ Virtual clusters

---

# ğŸ“¦ Pods in Kubernetes

Pods = **Encapsulation of containers, storage, and network resources**.
ğŸ‘‰ They are the **smallest deployable unit** in Kubernetes.

### ğŸ“Œ Two Types of Pods:

1ï¸âƒ£ **Single-container Pod** (most common)
2ï¸âƒ£ **Multi-container Pod** (sidecar pattern, tightly coupled apps)

---

## ğŸ“ Example â€“ Single Container Pod

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
  labels:
    app: nginx
spec:
  containers:
  - name: nginx-container
    image: nginx:latest
    ports:
    - containerPort: 80
```

---

## ğŸ“ Example â€“ Multi-Container Pod

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: multi-container-pod
spec:
  containers:
  - name: main-container
    image: nginx:latest
    ports:
    - containerPort: 80
  - name: sidecar-container
    image: busybox:latest
    command: ["sh", "-c", "while true; do echo 'Sidecar Running'; sleep 5; done"]
```

---

# ğŸ•¹ï¸ Pod Controllers

### ğŸ”¹ Types

* ğŸ“¤ **Deployment** â†’ Stateless apps
* ğŸŒ **DaemonSet** â†’ One pod per node
* ğŸ—„ï¸ **StatefulSet** â†’ Stateful apps (databases, Kafka)

---

## âš–ï¸ Deployment vs DaemonSet vs StatefulSet

| Controller      | Purpose                        | Scaling                   | Pod Identity         | Use Case                        |
| --------------- | ------------------------------ | ------------------------- | -------------------- | ------------------------------- |
| **Deployment**  | Run/manage stateless apps      | Multiple replicas         | Interchangeable pods | Web apps, REST APIs             |
| **DaemonSet**   | One pod per node (agent model) | Adds/removes with nodes   | One copy per node    | Logging, monitoring, CNI agents |
| **StatefulSet** | Run/manage stateful apps       | Unique, sticky identities | Persistent identity  | DBs, Kafka, Zookeeper           |

---

# ğŸ“ˆ Kubernetes Scalability Limits

* ğŸ›‘ **Max pods per node** â†’ `110`
* ğŸ›‘ **Max nodes per cluster** â†’ `5000`
* ğŸ›‘ **Max pods per cluster** â†’ `150,000`
* ğŸ›‘ **Max containers per cluster** â†’ `300,000`

---

# ğŸš€ Kubernetes Deployment

### ğŸ“Œ Definition

A **Deployment** is used for **stateless apps**. Ensures desired replicas, supports **rolling updates & rollbacks**.

### ğŸ› ï¸ Deployment Example

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: web
spec:
  replicas: 3
  selector:
    matchLabels:
      app: web
  template:
    metadata:
      labels:
        app: web
    spec:
      containers:
      - name: web-container
        image: nginx:1.14.2
        ports:
        - containerPort: 80
```

ğŸ‘‰ Apply in namespace:

```bash
kubectl apply -f nginx-deployment.yml --namespace=ictm-dev
```

---

### ğŸ“Œ Deployment Commands

```bash
kubectl create deployment nginx --image=nginx
kubectl get deployments
kubectl describe deployment nginx
kubectl scale deployment nginx --replicas=5
kubectl rollout status deployment nginx
kubectl rollout undo deployment nginx
```

---

# ğŸŒ Kubernetes Services

| Type             | Scope/Access              | Typical Use Case                         |
| ---------------- | ------------------------- | ---------------------------------------- |
| **ClusterIP**    | Internal only             | Backend services, inter-pod comms        |
| **NodePort**     | External via NodeIP\:Port | Simple external access (dev/test)        |
| **LoadBalancer** | External via Public IP    | Production external services             |
| **ExternalName** | DNS mapping to external   | Use external DB, external APIs           |
| **Headless**     | No ClusterIP, DNS per pod | StatefulSets, direct pod addressing      |
| **Ingress**      | HTTP/HTTPS routing        | Websites, APIs, multiple services access |

---

# ğŸ’¾ Kubernetes Storage

### ğŸ—„ï¸ Persistent Volume (PV)

* Cluster-wide storage resource
* Created by **Admin** (or dynamically via StorageClass)
* Lifecycle independent of Pods

### ğŸ“¥ Persistent Volume Claim (PVC)

* Storage **request** from a user/app
* Namespace-level object
* Can trigger dynamic PV provisioning

ğŸ‘‰ **In short**:

* **PV** = Actual storage (Admin-defined)
* **PVC** = Request for storage (User-defined)
* **Pod** = Uses PVC to consume PV

---

## ğŸ“ PV & PVC Example

```yaml
# Persistent Volume
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-example
spec:
  capacity:
    storage: 5Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: "/mnt/data"
```

```yaml
# Persistent Volume Claim
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: pvc-example
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
```

```yaml
# Pod using PVC
apiVersion: v1
kind: Pod
metadata:
  name: pod-using-pvc
spec:
  containers:
  - name: app
    image: nginx
    volumeMounts:
    - mountPath: "/usr/share/nginx/html"
      name: storage
  volumes:
  - name: storage
    persistentVolumeClaim:
      claimName: pvc-example
```

---

# ğŸ—ï¸ StatefulSet

* For **stateful apps** (databases, message brokers, monitoring, storage nodes).
* Provides:

  * âœ… Stable, unique network IDs
  * âœ… Persistent storage
  * âœ… Ordered deployment/scaling
  * âœ… Graceful rolling updates

---

ğŸ“Œ **Summary**

* ğŸ³ Docker Swarm â†’ lightweight, good for small setups.
* â˜¸ï¸ Kubernetes â†’ enterprise-grade orchestration with auto-scaling, self-healing, load balancing.
* ğŸ“¦ Pods â†’ smallest deployable unit.
* ğŸ•¹ï¸ Controllers â†’ Deployments (stateless), DaemonSets (per node), StatefulSets (stateful apps).
* ğŸŒ Services â†’ Expose apps internally or externally.
* ğŸ’¾ PV/PVC â†’ Manage persistent storage.

---
