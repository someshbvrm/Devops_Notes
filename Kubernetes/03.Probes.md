
---

# ğŸš€ Kubernetes Advanced Concepts

---

## ğŸ” Probe (Health Checks)

A **probe** is a diagnostic tool used by Kubernetes to check the **health and status** of a container within a Pod.

### ğŸ“Œ Types of Probes

1. **ğŸ©º Liveness Probe**

   * Detects if a container is stuck or deadlocked.
   * If unhealthy â†’ Pod is automatically restarted.
   * Example use case: Catch deadlocks.

2. **âœ… Readiness Probe**

   * Checks if a Pod is **ready to serve traffic**.
   * Service only routes traffic when Pod is marked as **Ready**.

3. **â³ Startup Probe**

   * Helps with **slow-starting applications**.
   * Prevents liveness/readiness probes from killing the Pod prematurely.

ğŸ“˜ **Example Best Practice**
Use the **same endpoint** for readiness & liveness probes, but configure liveness with a **higher `failureThreshold`**.

---

## ğŸŒ Kubernetes Network Policies

A **NetworkPolicy** is like a **virtual firewall** for Pods. It defines how Pods can communicate with each other and external resources.

### âœ¨ Key Characteristics

* **Namespace-scoped** ğŸ”’
* **Selector-based** ğŸ¯ (uses `podSelector`)
* **Default Allow â†’ Default Deny** when policy is applied
* **Ingress** (inbound) & **Egress** (outbound) rules

### ğŸ“Œ Common Use Cases

* ğŸ”’ Isolate frontend Pods â†’ only talk to backend Pods.
* ğŸ— Multi-tier apps (web â†’ API â†’ DB).
* ğŸš« Deny all traffic by default, allow only specific flows.

âš ï¸ **Requirement**: Needs a **CNI plugin** that supports NetworkPolicy (e.g., Calico, Cilium).

ğŸ“„ **Example: `service/networking/networkpolicy.yaml`**

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: test-network-policy
  namespace: default
spec:
  podSelector:
    matchLabels:
      role: db
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - ipBlock:
        cidr: 172.17.0.0/16
        except:
        - 172.17.1.0/24
    - namespaceSelector:
        matchLabels:
          project: myproject
    - podSelector:
        matchLabels:
          role: frontend
    ports:
    - protocol: TCP
      port: 6379
  egress:
  - to:
    - ipBlock:
        cidr: 10.0.0.0/24
    ports:
    - protocol: TCP
      port: 5978
```

---

## ğŸ“Š ResourceQuota

A **ResourceQuota** limits **resource consumption** within a namespace.

### âœ¨ Key Features

* ğŸ—‚ **Namespace-scoped**
* âš¡ Control **CPU, Memory, Storage**
* ğŸ“¦ Restrict object counts (Pods, PVCs, Services, etc.)
* âœ… Enforced at **admission time**

### ğŸ“Œ Use Cases

* Prevent one team from consuming all resources.
* Fair resource distribution among namespaces.
* Limit expensive resources like **LoadBalancers** or **PVCs**.

ğŸ“„ **Example: `policy/quota.yaml`**

```yaml
apiVersion: v1
kind: List
items:
- apiVersion: v1
  kind: ResourceQuota
  metadata:
    name: pods-high
  spec:
    hard:
      cpu: "1000"
      memory: "200Gi"
      pods: "10"
    scopeSelector:
      matchExpressions:
      - operator: In
        scopeName: PriorityClass
        values: ["high"]

- apiVersion: v1
  kind: ResourceQuota
  metadata:
    name: pods-medium
  spec:
    hard:
      cpu: "10"
      memory: "20Gi"
      pods: "10"
    scopeSelector:
      matchExpressions:
      - operator: In
        scopeName: PriorityClass
        values: ["medium"]

- apiVersion: v1
  kind: ResourceQuota
  metadata:
    name: pods-low
  spec:
    hard:
      cpu: "5"
      memory: "10Gi"
      pods: "10"
    scopeSelector:
      matchExpressions:
      - operator: In
        scopeName: PriorityClass
        values: ["low"]
```

---

## âš™ï¸ ConfigMap

ğŸ“¦ **Purpose**: Store **non-confidential configuration data** (keyâ€“value pairs).

* Keeps configs separate from container images.
* Consumed as **env variables, CLI args, or volumes**.

ğŸ“„ **Example: ConfigMap**

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: dev
data:
  APP_MODE: "production"
  LOG_LEVEL: "debug"
```

ğŸ“„ **Using ConfigMap in Pod**

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: demo-pod
spec:
  containers:
    - name: myapp
      image: nginx
      envFrom:
        - configMapRef:
            name: app-config
```

---

## ğŸ”‘ Secret

ğŸ”’ **Purpose**: Store **sensitive data** (passwords, tokens).

* Data stored in **Base64 encoding** (not encryption by default).
* Mounted as files or injected as environment variables.

ğŸ“„ **Example: Secret**

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: db-secret
  namespace: dev
type: Opaque
data:
  username: YWRtaW4=        # "admin"
  password: cGFzc3dvcmQ=    # "password"
```

ğŸ“„ **Using Secret in Pod**

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: db-pod
spec:
  containers:
    - name: db-client
      image: mysql
      env:
        - name: DB_USER
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: username
```

ğŸ“Š **ConfigMap vs Secret**

| Feature   | âš™ï¸ ConfigMap       | ğŸ”’ Secret                               |
| --------- | ------------------ | --------------------------------------- |
| Stores    | Non-sensitive data | Sensitive data (passwords, API keys)    |
| Encoding  | Plain text         | Base64 encoded                          |
| Use Cases | App configs, flags | Passwords, tokens, certificates         |
| Security  | Less secure        | More secure (RBAC + encryption at rest) |

---

## ğŸŒ Ingress

An **Ingress** manages **external access** (usually HTTP/HTTPS) to cluster services.

### âœ¨ Features

* Load balancing âš–ï¸
* SSL/TLS termination ğŸ”
* Name-based virtual hosting ğŸŒ

âš ï¸ **Requires an Ingress Controller** (e.g., NGINX, Traefik).

ğŸ“„ **Example: `service/networking/minimal-ingress.yaml`**

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: minimal-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  ingressClassName: nginx-example
  rules:
  - http:
      paths:
      - path: /testpath
        pathType: Prefix
        backend:
          service:
            name: test
            port:
              number: 80
```

---

## ğŸ“š Terminology

* **ğŸ–¥ Node** â†’ Worker machine in Kubernetes.
* **â˜¸ï¸ Cluster** â†’ Set of nodes running apps managed by Kubernetes.
* **ğŸ›¡ Edge Router** â†’ Enforces firewall rules for your cluster.
* **ğŸŒ Cluster Network** â†’ Communication links between nodes/pods.
* **ğŸ”— Service** â†’ Abstraction that exposes a set of Pods (via labels).

ğŸ“– Reference: [Kubernetes Ingress Docs](https://kubernetes.io/docs/concepts/services-networking/ingress/)

---
