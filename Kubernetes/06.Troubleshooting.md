
---

# â˜¸ï¸ Kubernetes Cluster Management & Troubleshooting Cheat Sheet

---

## ğŸš€ Cluster Bootstrapping Options

* **Kubeadm** ğŸ› ï¸ â†’ CLI tool to bootstrap Kubernetes clusters.
* **Kubespray** ğŸ¤– â†’ Ansible role that automates Kubernetes cluster setup.
* **Managed Services** ğŸŒ

  * **Amazon EKS** ğŸŸ¦
  * **Azure AKS** ğŸŸ©
  * **Google GKE** ğŸŸ¥

ğŸ‘‰ Example:

> **Q:** How many nodes in your cluster?
> **A:** *20 nodes with autoscaling up to 40.*

ğŸ”¹ In **EKS**, worker nodes can run as EC2 instances or use **AWS Fargate** (serverless).
ğŸ”¹ IAM Roles are required to manage **permissions** for EKS.

---

## ğŸ› ï¸ Basic Cluster Troubleshooting

### ğŸ” Cluster & Node Checks

```bash
kubectl get nodes
kubectl cluster-info
kubectl cluster-info dump
kubectl describe node <NODE_NAME>
```

### ğŸ“‚ Logs for Control Plane

* `/var/log/kube-apiserver.log` â†’ API Server
* `/var/log/kube-scheduler.log` â†’ Scheduler
* `/var/log/kube-controller-manager.log` â†’ Controller Manager

### ğŸ“‚ Logs for Worker Nodes

* `/var/log/kubelet.log` â†’ Kubelet (runs containers)
* `/var/log/kube-proxy.log` â†’ Kube-proxy (service traffic)

### âš¡ Common Failure Causes

* âŒ VM shutdown
* ğŸŒ Network partition (between cluster / users)
* ğŸ’¥ Crashes in Kubernetes components
* ğŸ“¦ Persistent storage unavailable (EBS, GCE PD)
* ğŸ‘¨â€ğŸ’» Operator error (misconfiguration)

ğŸ” Monitor metrics using **Prometheus & Grafana**.

---

## ğŸ§ª Debugging with Kubectl

### ğŸ”§ Debug Nodes

```bash
kubectl debug node <NODE_NAME>
```

### ğŸ”§ Debug Pods

```bash
kubectl get pods -n <NAMESPACE>
kubectl describe pods <POD_NAME>
kubectl logs <POD_NAME> <CONTAINER_NAME>
kubectl exec <POD_NAME> -c <CONTAINER_NAME> -- <CMD> <ARGS>
kubectl get events -n <NAMESPACE>
```

ğŸ“Œ Example:

```bash
kubectl exec cassandra -- cat /var/log/cassandra/system.log
```

---

## ğŸ Common Pod Issues

### ğŸŸ¡ Pod Pending

* Scheduler canâ€™t place pod:

  * All nodes overloaded
  * Node affinity/taints preventing scheduling
  * Host port conflict

### ğŸŸ  Pod Waiting

* Pod scheduled but not running:

  * Image pull issues
  * Wrong image name/tag
  * Registry credentials missing
  * Network/firewall issues

Check:

```bash
docker pull <image>
```

### ğŸ”´ CrashLoopBackOff

A pod is restarting repeatedly because of:

* âŒ Misconfiguration
* ğŸ“¦ Missing PV/PVC
* âš¡ Wrong command/args
* ğŸ› Application bugs
* ğŸ” Permission issues
* ğŸ§  OOMKilled (low memory limits)
* ğŸ›‘ Liveness probe failures

âœ… **Course of Action**:

1. Check pod description â†’ `kubectl describe pod <POD>`
2. Check logs â†’ `kubectl logs <POD>`
3. Check events â†’ `kubectl get events`
4. Verify Deployment/ReplicaSet
5. Inspect Dockerfile (entrypoint/cmd/envs)
6. Validate restart policy
7. Check PV/PVC permissions
8. Look at monitoring (Prometheus/Grafana)

---

## ğŸ”Ÿ Top Issues, Diagnosis & Fix

| âš ï¸ Issue                  | ğŸ” How to Identify                         | ğŸ› ï¸ Fix                                            |
| ------------------------- | ------------------------------------------ | -------------------------------------------------- |
| Pod Pending               | `kubectl describe pod` shows unschedulable | Add resources, fix affinity/taints                 |
| ImagePullBackOff          | Pod Waiting, logs show image error         | Fix image name/tag, push to registry, update creds |
| CrashLoopBackOff          | Pod restarts repeatedly                    | Fix misconfig, memory, entrypoint                  |
| Node NotReady             | `kubectl get nodes` shows NotReady         | Restart kubelet, check logs                        |
| Kubelet Down              | `/var/log/kubelet.log`                     | Restart kubelet/systemd                            |
| Service Not Accessible    | `kubectl describe svc`                     | Fix selector, endpoints, kube-proxy logs           |
| PV Pending                | `kubectl get pvc` stuck in Pending         | Ensure storage class, check cloud provider         |
| Pod Evicted               | Event shows `Evicted`                      | Add resources, reduce requests/limits              |
| Liveness Probe Failures   | Pod restarts due to probe                  | Fix health endpoint, adjust timeout                |
| Network Policies Blocking | Pods canâ€™t talk                            | Adjust NetworkPolicy, verify CNI plugin            |

---

## âš¡ Extra Kubernetes Topics

### ğŸ› ï¸ Init Containers

* Run before main containers start
* Used for setup tasks (e.g., config, DB migration)

### â±ï¸ Jobs

* Run to completion (e.g., batch tasks)

### â³ CronJobs

* Run on schedule (e.g., backups, reports)

### ğŸ§© Custom Resource Definitions (CRDs)

* Extend Kubernetes API with custom objects

### ğŸ“Œ Static Pods

* Defined by manifest files on **kubelet** (`/etc/kubernetes/manifests/`)
* Always run on specific node (control plane components often run this way)

---
