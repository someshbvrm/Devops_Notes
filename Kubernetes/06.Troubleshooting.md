
---

# ☸️ Kubernetes Cluster Management & Troubleshooting Cheat Sheet

---

## 🚀 Cluster Bootstrapping Options

* **Kubeadm** 🛠️ → CLI tool to bootstrap Kubernetes clusters.
* **Kubespray** 🤖 → Ansible role that automates Kubernetes cluster setup.
* **Managed Services** 🌐

  * **Amazon EKS** 🟦
  * **Azure AKS** 🟩
  * **Google GKE** 🟥

👉 Example:

> **Q:** How many nodes in your cluster?
> **A:** *20 nodes with autoscaling up to 40.*

🔹 In **EKS**, worker nodes can run as EC2 instances or use **AWS Fargate** (serverless).
🔹 IAM Roles are required to manage **permissions** for EKS.

---

## 🛠️ Basic Cluster Troubleshooting

### 🔍 Cluster & Node Checks

```bash
kubectl get nodes
kubectl cluster-info
kubectl cluster-info dump
kubectl describe node <NODE_NAME>
```

### 📂 Logs for Control Plane

* `/var/log/kube-apiserver.log` → API Server
* `/var/log/kube-scheduler.log` → Scheduler
* `/var/log/kube-controller-manager.log` → Controller Manager

### 📂 Logs for Worker Nodes

* `/var/log/kubelet.log` → Kubelet (runs containers)
* `/var/log/kube-proxy.log` → Kube-proxy (service traffic)

### ⚡ Common Failure Causes

* ❌ VM shutdown
* 🌐 Network partition (between cluster / users)
* 💥 Crashes in Kubernetes components
* 📦 Persistent storage unavailable (EBS, GCE PD)
* 👨‍💻 Operator error (misconfiguration)

🔎 Monitor metrics using **Prometheus & Grafana**.

---

## 🧪 Debugging with Kubectl

### 🔧 Debug Nodes

```bash
kubectl debug node <NODE_NAME>
```

### 🔧 Debug Pods

```bash
kubectl get pods -n <NAMESPACE>
kubectl describe pods <POD_NAME>
kubectl logs <POD_NAME> <CONTAINER_NAME>
kubectl exec <POD_NAME> -c <CONTAINER_NAME> -- <CMD> <ARGS>
kubectl get events -n <NAMESPACE>
```

📌 Example:

```bash
kubectl exec cassandra -- cat /var/log/cassandra/system.log
```

---

## 🐞 Common Pod Issues

### 🟡 Pod Pending

* Scheduler can’t place pod:

  * All nodes overloaded
  * Node affinity/taints preventing scheduling
  * Host port conflict

### 🟠 Pod Waiting

* Pod scheduled but not running:

  * Image pull issues
  * Wrong image name/tag
  * Registry credentials missing
  * Network/firewall issues

Check:

```bash
docker pull <image>
```

### 🔴 CrashLoopBackOff

A pod is restarting repeatedly because of:

* ❌ Misconfiguration
* 📦 Missing PV/PVC
* ⚡ Wrong command/args
* 🐛 Application bugs
* 🔐 Permission issues
* 🧠 OOMKilled (low memory limits)
* 🛑 Liveness probe failures

✅ **Course of Action**:

1. Check pod description → `kubectl describe pod <POD>`
2. Check logs → `kubectl logs <POD>`
3. Check events → `kubectl get events`
4. Verify Deployment/ReplicaSet
5. Inspect Dockerfile (entrypoint/cmd/envs)
6. Validate restart policy
7. Check PV/PVC permissions
8. Look at monitoring (Prometheus/Grafana)

---

## 🔟 Top Issues, Diagnosis & Fix

| ⚠️ Issue                  | 🔍 How to Identify                         | 🛠️ Fix                                            |
| ------------------------- | ------------------------------------------ | -------------------------------------------------- |
| Pod Pending               | `kubectl describe pod` shows unschedulable | Add resources, fix affinity/taints                 |
| ImagePullBackOff          | Pod Waiting, logs show image error         | Fix image name/tag, push to registry, update creds |
| CrashLoopBackOff          | Pod restarts repeatedly                    | Fix misconfig, memory, entrypoint                  |
| Node NotReady             | `kubectl get nodes` shows NotReady         | Restart kubelet, check logs                        |
| Kubelet Down              | `/var/log/kubelet.log`                     | Restart kubelet/systemd                            |
| Service Not Accessible    | `kubectl describe svc`                     | Fix selector, endpoints, kube-proxy logs           |
| PV Pending                | `kubectl get pvc` stuck in Pending         | Ensure storage class, check cloud provider         |
| Pod Evicted               | Event shows `Evicted`                      | Add resources, reduce requests/limits              |
| Liveness Probe Failures   | Pod restarts due to probe                  | Fix health endpoint, adjust timeout                |
| Network Policies Blocking | Pods can’t talk                            | Adjust NetworkPolicy, verify CNI plugin            |

---

## ⚡ Extra Kubernetes Topics

### 🛠️ Init Containers

* Run before main containers start
* Used for setup tasks (e.g., config, DB migration)

### ⏱️ Jobs

* Run to completion (e.g., batch tasks)

### ⏳ CronJobs

* Run on schedule (e.g., backups, reports)

### 🧩 Custom Resource Definitions (CRDs)

* Extend Kubernetes API with custom objects

### 📌 Static Pods

* Defined by manifest files on **kubelet** (`/etc/kubernetes/manifests/`)
* Always run on specific node (control plane components often run this way)

---
